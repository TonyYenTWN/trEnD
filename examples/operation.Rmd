```{r setup, include = FALSE}
library("rstudioapi")
library(plotly)
library(rgdal)
library(rgeos)
library(fields)

##################################################################################
Time <- 336

# Set time name
year <- 2021
days_of_month <- c(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31)
hours <- c()
count <- 0
for(month_iter in 1:12){
  if(month_iter < 10){
    month_name <- paste(0, month_iter, sep = "")
  }else{
    month_name <- month_iter
  }
  
  
  for(day_iter in 1:days_of_month[month_iter]){
    if(day_iter < 10){
      day_name <- paste(0, day_iter, sep = "")
    }else{
      day_name <- day_iter
    }
    
    for(hour_iter in 0:23){
      count <- count + 1
      
      if(hour_iter < 10){
        hour_name <- paste(0, hour_iter, sep = "")
      }else{
        hour_name <- hour_iter
      }
      
      hours[count] <- paste(year, "-", month_name, "-", day_name, " ", hour_name, ":00", sep = "")
    }
  }
}

timestamp_01 <- hours[1:Time]
timestamp_02 <- hours[4344 + 1:Time]

##################################################################################

parent_dir = dirname(getwd())
setwd(parent_dir)

### Plot canvas for maps
dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "NO_10k/NO_10k.shp"
map_data <- readOGR(paste(dir_name, file_name, sep = ""))
norway_map_union <- gUnaryUnion(map_data)

file_name <- "transmission_nodes.csv"
node_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")

margin <- 18000
x_min <- min(norway_map_union@polygons[[1]]@Polygons[[1]]@coords[, 1], node_data$x) - margin
y_min <- min(norway_map_union@polygons[[1]]@Polygons[[1]]@coords[, 2], node_data$y) - margin
x_max <- max(norway_map_union@polygons[[1]]@Polygons[[1]]@coords[, 1], node_data$x) + margin
y_max <- max(norway_map_union@polygons[[1]]@Polygons[[1]]@coords[, 2], node_data$y) + margin
x_range <- c(x_min, x_max)
y_range <- c(y_min, y_max)
w_plot_map <- 700
h_plot_map <- w_plot_map * diff(y_range) / diff(x_range)
NO_power_system_plot <- plot_ly(width = w_plot_map, height = h_plot_map, showlegend = FALSE) %>%
  add_trace(x = norway_map_union@polygons[[1]]@Polygons[[1]]@coords[, 1], 
  y = norway_map_union@polygons[[1]]@Polygons[[1]]@coords[, 2], 
  type = 'scatter', mode = 'lines', name = "Border", line = list(color = "black"), hoverinfo = 'none') %>%
  layout(xaxis = list(showgrid = F, automargin = FALSE, range = x_range, showline = FALSE, showticklabels = FALSE), 
  yaxis = list(showgrid = F, automargin = FALSE, range = y_range, showline = FALSE, showticklabels = FALSE),
  margin = list(b = 0, t = 0, l = 0, r = 0),
  font = list(family = "times new roman")
  )
NO_power_system_plot <- NO_power_system_plot %>%
  config(
    toImageButtonOptions = list(
      format = "svg",
      filename = "map_plot",
      width = w_plot_map,
      height = h_plot_map
    )
  )

### Plot canvas for operation schedule
operation_plot <- plot_ly(type = 'bar') %>%
  layout(showlegend = F, 
  xaxis = list(rangeslider = list(visible = T), showgrid = F),
  yaxis = list(showgrid = F, showline = T, title = "Electricity (GWh)"),
  barmode = 'stack',
  bargap = .05,
  font = list(family = "times new roman")    
  )
operation_plot <- operation_plot %>%
  config(
    toImageButtonOptions = list(
      format = "svg",
      filename = "operation_plot"
    )
  )

##################################################################################

### Parameters for the field
library(RColorBrewer)

file_name <- "point_info.csv"
point_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")

file_name <- "point_matrix.csv"
point_matrix <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")

x_range_field <- range(point_data$x)
y_range_field  <- range(point_data$y)
res_field  <- 10000

##################################################################################

fractal_power <- 1
reference_power_dc <- 2200
reference_power_ac <- 0
reference_power_dc_diff_1 <- 550
reference_power_dc_diff_2 <- 20
reference_edge_dc_diff_1 <- .2
reference_edge_dc_diff_2 <- .01
reference_voltage <- c(1, 1)
```

<!-- title for toc -->
# Time Series 

<!-- title for toc -->
## - EOM Schedule {.tabset .tabset-fade .tabset-pills}

### NO1

#### January
```{r EOM schedule NO1 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = -(cross_border$NO1[1:Time] < 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = -end_user$NO1[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = -industrial$NO1[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = -(pump_storage$NO1[1:Time] < 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO1[1:Time] > 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = hydro$NO1[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = wind$NO1[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_01, y = (pump_storage$NO1[1:Time] > 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r EOM schedule NO1 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = -(cross_border$NO1[1:Time] < 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = -end_user$NO1[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = -industrial$NO1[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = -(pump_storage$NO1[1:Time] < 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO1[1:Time] > 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = hydro$NO1[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = wind$NO1[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_02, y = (pump_storage$NO1[1:Time] > 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO2

#### January
```{r EOM schedule NO2 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = -(cross_border$NO2[1:Time] < 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = -end_user$NO2[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = -industrial$NO2[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = -(pump_storage$NO2[1:Time] < 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO2[1:Time] > 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = hydro$NO2[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = wind$NO2[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_01, y = (pump_storage$NO2[1:Time] > 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r EOM schedule NO2 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = -(cross_border$NO2[1:Time] < 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = -end_user$NO2[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = -industrial$NO2[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = -(pump_storage$NO2[1:Time] < 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO2[1:Time] > 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = hydro$NO2[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = wind$NO2[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_02, y = (pump_storage$NO2[1:Time] > 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO3

#### January
```{r EOM schedule NO3 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = -(cross_border$NO3[1:Time] < 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = -end_user$NO3[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = -industrial$NO3[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = -(pump_storage$NO3[1:Time] < 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO3[1:Time] > 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = hydro$NO3[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = wind$NO3[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_01, y = (pump_storage$NO3[1:Time] > 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r EOM schedule NO3 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = -(cross_border$NO3[1:Time] < 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = -end_user$NO3[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = -industrial$NO3[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = -(pump_storage$NO3[1:Time] < 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO3[1:Time] > 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = hydro$NO3[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = wind$NO3[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_02, y = (pump_storage$NO3[1:Time] > 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO4

#### January
```{r EOM schedule NO4 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = -(cross_border$NO4[1:Time] < 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = -end_user$NO4[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = -industrial$NO4[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = -(pump_storage$NO4[1:Time] < 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO4[1:Time] > 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = hydro$NO4[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = wind$NO4[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_01, y = (pump_storage$NO4[1:Time] > 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r EOM schedule NO4 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = -(cross_border$NO4[1:Time] < 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = -end_user$NO4[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = -industrial$NO4[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = -(pump_storage$NO4[1:Time] < 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO4[1:Time] > 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = hydro$NO4[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = wind$NO4[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_02, y = (pump_storage$NO4[1:Time] > 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO5

#### January
```{r EOM schedule NO5 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = -(cross_border$NO5[1:Time] < 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = -end_user$NO5[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = -industrial$NO5[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = -(pump_storage$NO5[1:Time] < 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO5[1:Time] > 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = hydro$NO5[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = wind$NO5[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_01, y = (pump_storage$NO5[1:Time] > 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r EOM schedule NO5 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_EOM_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_EOM_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Demand (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = -(cross_border$NO5[1:Time] < 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = -end_user$NO5[1:Time] / 1000, name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = -industrial$NO5[1:Time] / 1000, name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = -(pump_storage$NO5[1:Time] < 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Electricity Supply (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO5[1:Time] > 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = hydro$NO5[1:Time] / 1000, name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = wind$NO5[1:Time] / 1000, name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%
  add_trace(x = timestamp_02, y = (pump_storage$NO5[1:Time] > 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

<!-- title for toc -->
## - Redispatch Schedule {.tabset .tabset-fade .tabset-pills}

### NO1

#### January
```{r redispatch schedule NO1 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO1[1:Time] > 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO1[1:Time] > 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO1[1:Time] > 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO1[1:Time] > 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO1[1:Time] > 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO1[1:Time] > 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO1[1:Time] < 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO1[1:Time] < 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO1[1:Time] < 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO1[1:Time] < 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO1[1:Time] < 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO1[1:Time] < 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r redispatch schedule NO1 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO1[1:Time] > 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO1[1:Time] > 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO1[1:Time] > 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO1[1:Time] > 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO1[1:Time] > 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO1[1:Time] > 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO1[1:Time] < 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO1[1:Time] < 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO1[1:Time] < 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO1[1:Time] < 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO1[1:Time] < 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO1[1:Time] < 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO2

#### January
```{r redispatch schedule NO2 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO2[1:Time] > 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO2[1:Time] > 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO2[1:Time] > 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO2[1:Time] > 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO2[1:Time] > 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO2[1:Time] > 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO2[1:Time] < 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO2[1:Time] < 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO2[1:Time] < 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO2[1:Time] < 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO2[1:Time] < 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO2[1:Time] < 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r redispatch schedule NO2 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO2[1:Time] > 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO2[1:Time] > 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO2[1:Time] > 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO2[1:Time] > 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO2[1:Time] > 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO2[1:Time] > 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO2[1:Time] < 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO2[1:Time] < 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO2[1:Time] < 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO2[1:Time] < 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO2[1:Time] < 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO2[1:Time] < 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO3

#### January
```{r redispatch schedule NO3 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO3[1:Time] > 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO3[1:Time] > 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO3[1:Time] > 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO3[1:Time] > 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO3[1:Time] > 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO3[1:Time] > 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO3[1:Time] < 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO3[1:Time] < 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO3[1:Time] < 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO3[1:Time] < 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO3[1:Time] < 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO3[1:Time] < 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r redispatch schedule NO3 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO3[1:Time] > 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO3[1:Time] > 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO3[1:Time] > 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO3[1:Time] > 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO3[1:Time] > 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO3[1:Time] > 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO3[1:Time] < 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO3[1:Time] < 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO3[1:Time] < 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO3[1:Time] < 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO3[1:Time] < 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO3[1:Time] < 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO4

#### January
```{r redispatch schedule NO4 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO4[1:Time] > 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO4[1:Time] > 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO4[1:Time] > 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO4[1:Time] > 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO4[1:Time] > 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO4[1:Time] > 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO4[1:Time] < 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO4[1:Time] < 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO4[1:Time] < 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO4[1:Time] < 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO4[1:Time] < 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO4[1:Time] < 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r redispatch schedule NO4 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO4[1:Time] > 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO4[1:Time] > 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO4[1:Time] > 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO4[1:Time] > 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO4[1:Time] > 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO4[1:Time] > 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO4[1:Time] < 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO4[1:Time] < 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO4[1:Time] < 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO4[1:Time] < 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO4[1:Time] < 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO4[1:Time] < 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO5

#### January
```{r redispatch schedule NO5 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO5[1:Time] > 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO5[1:Time] > 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO5[1:Time] > 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO5[1:Time] > 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO5[1:Time] > 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO5[1:Time] > 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO5[1:Time] < 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO5[1:Time] < 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO5[1:Time] < 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO5[1:Time] < 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO5[1:Time] < 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO5[1:Time] < 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r redispatch schedule NO5 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_redispatch_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_redispatch_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO5[1:Time] > 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO5[1:Time] > 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO5[1:Time] > 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO5[1:Time] > 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO5[1:Time] > 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO5[1:Time] > 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "Redispatched Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO5[1:Time] < 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO5[1:Time] < 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO5[1:Time] < 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO5[1:Time] < 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO5[1:Time] < 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO5[1:Time] < 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

<!-- title for toc -->
## - Balancing Activation {.tabset .tabset-fade .tabset-pills}

### NO1

#### January
```{r balancing schedule NO1 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO1[1:Time] > 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO1[1:Time] > 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO1[1:Time] > 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO1[1:Time] > 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO1[1:Time] > 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO1[1:Time] > 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO1[1:Time] < 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO1[1:Time] < 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO1[1:Time] < 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO1[1:Time] < 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO1[1:Time] < 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO1[1:Time] < 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r balancing schedule NO1 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO1[1:Time] > 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO1[1:Time] > 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO1[1:Time] > 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO1[1:Time] > 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO1[1:Time] > 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO1[1:Time] > 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO1[1:Time] < 0) * cross_border$NO1[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO1[1:Time] < 0) * end_user$NO1[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO1[1:Time] < 0) * industrial$NO1[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO1[1:Time] < 0) * hydro$NO1[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO1[1:Time] < 0) * wind$NO1[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO1[1:Time] < 0) * pump_storage$NO1[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO2

#### January
```{r balancing schedule NO2 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO2[1:Time] > 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO2[1:Time] > 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO2[1:Time] > 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO2[1:Time] > 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO2[1:Time] > 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO2[1:Time] > 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO2[1:Time] < 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO2[1:Time] < 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO2[1:Time] < 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO2[1:Time] < 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO2[1:Time] < 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO2[1:Time] < 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r balancing schedule NO2 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO2[1:Time] > 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO2[1:Time] > 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO2[1:Time] > 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO2[1:Time] > 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO2[1:Time] > 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO2[1:Time] > 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO2[1:Time] < 0) * cross_border$NO2[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO2[1:Time] < 0) * end_user$NO2[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO2[1:Time] < 0) * industrial$NO2[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO2[1:Time] < 0) * hydro$NO2[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO2[1:Time] < 0) * wind$NO2[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO2[1:Time] < 0) * pump_storage$NO2[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO3

#### January
```{r balancing schedule NO3 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO3[1:Time] > 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO3[1:Time] > 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO3[1:Time] > 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO3[1:Time] > 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO3[1:Time] > 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO3[1:Time] > 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO3[1:Time] < 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO3[1:Time] < 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO3[1:Time] < 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO3[1:Time] < 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO3[1:Time] < 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO3[1:Time] < 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r balancing schedule NO3 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO3[1:Time] > 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO3[1:Time] > 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO3[1:Time] > 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO3[1:Time] > 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO3[1:Time] > 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO3[1:Time] > 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO3[1:Time] < 0) * cross_border$NO3[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO3[1:Time] < 0) * end_user$NO3[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO3[1:Time] < 0) * industrial$NO3[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO3[1:Time] < 0) * hydro$NO3[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO3[1:Time] < 0) * wind$NO3[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO3[1:Time] < 0) * pump_storage$NO3[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO4

#### January
```{r balancing schedule NO4 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO4[1:Time] > 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO4[1:Time] > 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO4[1:Time] > 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO4[1:Time] > 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO4[1:Time] > 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO4[1:Time] > 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO4[1:Time] < 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO4[1:Time] < 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO4[1:Time] < 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO4[1:Time] < 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO4[1:Time] < 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO4[1:Time] < 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r balancing schedule NO4 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO4[1:Time] > 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO4[1:Time] > 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO4[1:Time] > 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO4[1:Time] > 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO4[1:Time] > 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO4[1:Time] > 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO4[1:Time] < 0) * cross_border$NO4[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO4[1:Time] < 0) * end_user$NO4[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO4[1:Time] < 0) * industrial$NO4[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO4[1:Time] < 0) * hydro$NO4[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO4[1:Time] < 0) * wind$NO4[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO4[1:Time] < 0) * pump_storage$NO4[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

### NO5

#### January
```{r balancing schedule NO5 jan, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO5[1:Time] > 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO5[1:Time] > 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO5[1:Time] > 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO5[1:Time] > 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO5[1:Time] > 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO5[1:Time] > 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_01, y = (cross_border$NO5[1:Time] < 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_01, y = (end_user$NO5[1:Time] < 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_01, y = (industrial$NO5[1:Time] < 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_01, y = (hydro$NO5[1:Time] < 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO5[1:Time] < 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_01, y = (pump_storage$NO5[1:Time] < 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

#### July
```{r balancing schedule NO5 jul, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")
file_name <- "IMO_operation_balancing_cross_border.csv"
cross_border <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_end_user.csv"
end_user <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_hydro.csv"
hydro <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_industrial.csv"
industrial <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_pump_storage.csv"
pump_storage <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")
file_name <- "IMO_operation_balancing_wind.csv"
wind <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Up (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO5[1:Time] > 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO5[1:Time] > 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO5[1:Time] > 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO5[1:Time] > 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_02, y = (wind$NO5[1:Time] > 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO5[1:Time] > 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp

operation_plot_temp <- operation_plot
operation_plot_temp <- operation_plot_temp %>%
  layout(
  yaxis = list(showgrid = F, showline = T, title = "balancinged Electricity Down (GWh)")
  )
operation_plot_temp <- operation_plot_temp %>%
  add_trace(x = timestamp_02, y = (cross_border$NO5[1:Time] < 0) * cross_border$NO5[1:Time] / 1000, 
  name = "Cross-border", marker = list(color = '#9d529d')) %>%
  add_trace(x = timestamp_02, y = (end_user$NO5[1:Time] < 0) * end_user$NO5[1:Time] / 1000, 
  name = "End-user", marker = list(color = 'rgb(200,200,200)')) %>%
  add_trace(x = timestamp_02, y = (industrial$NO5[1:Time] < 0) * industrial$NO5[1:Time] / 1000, 
  name = "Industrial", marker = list(color = 'rgb(100,100,100)')) %>%
  add_trace(x = timestamp_02, y = (hydro$NO5[1:Time] < 0) * hydro$NO5[1:Time] / 1000, 
  name = "Hydro", marker = list(color = 'rgb(0,0,150)')) %>%
  add_trace(x = timestamp_01, y = (wind$NO5[1:Time] < 0) * wind$NO5[1:Time] / 1000, 
  name = "Wind", marker = list(color = 'rgb(100,200,150)')) %>%  
  add_trace(x = timestamp_02, y = (pump_storage$NO5[1:Time] < 0) * pump_storage$NO5[1:Time] / 1000, 
  name = "Pump Storage", marker = list(color = '#40b0e8'))

operation_plot_temp
```

<!-- title for toc -->
## - Resulting Operation {.tabset .tabset-fade .tabset-pills}
<!-- check box to consider EOM, EOM + redispatch, EOM + redispatch + balancing -->

<!-- title for toc -->
# Power Network 

<!-- title for toc -->
## - DC Power Flow {.tabset .tabset-fade .tabset-pills}
Below is the average utilization rate on lines and source (sink) at nodes on the DC approximated power network during the simulated time period.

### Reference 1 {.tabset .tabset-fade .tabset-pills}

#### January
```{r dc power flow jan ref 01, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

# node_average_balance <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
node_average_balance <- as.matrix(TSO_actual_supply)[96,] - as.matrix(TSO_actual_demand)[96,]
edge_average_flow <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow <- edge_average_flow / edge_data[, 3]
reference_power <- max(max(node_average_balance), -min(node_average_balance), reference_power_dc)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = edge_average_flow[edge_iter]^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- .25 * c(.5, 1, 2, 4)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

#### July
```{r dc power flow jul ref 01, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow <- edge_average_flow / edge_data[, 3]
reference_power <- max(max(node_average_balance), -min(node_average_balance), reference_power_dc)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = edge_average_flow[edge_iter]^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- .25 * c(.5, 1, 2, 4)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

### Reference 2 {.tabset .tabset-fade .tabset-pills}

#### January
```{r dc power flow jan ref 02, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_02"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow <- edge_average_flow / edge_data[, 3]
reference_power <- max(max(node_average_balance), -min(node_average_balance), reference_power_dc)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = edge_average_flow[edge_iter]^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- .25 * c(.5, 1, 2, 4)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

#### July
```{r dc power flow jul ref 02, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_02"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow <- edge_average_flow / edge_data[, 3]
reference_power <- max(max(node_average_balance), -min(node_average_balance), reference_power_dc)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = edge_average_flow[edge_iter]^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- .25 * c(.5, 1, 2, 4)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

### Active End-users {.tabset .tabset-fade .tabset-pills}

#### January
```{r dc power flow jan active, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "active_end_user"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow <- edge_average_flow / edge_data[, 3]
reference_power <- max(max(node_average_balance), -min(node_average_balance), reference_power_dc)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = edge_average_flow[edge_iter]^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- .25 * c(.5, 1, 2, 4)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

#### July
```{r dc power flow jul active, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "active_end_user"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow <- edge_average_flow / edge_data[, 3]
reference_power <- max(max(node_average_balance), -min(node_average_balance), reference_power_dc)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = edge_average_flow[edge_iter]^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- .25 * c(.5, 1, 2, 4)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

<!-- title for toc -->
## - DC Power System Operation Difference {.tabset .tabset-fade .tabset-pills}

### Difference Ref 2 - Ref 1 {.tabset .tabset-fade .tabset-pills}

#### January
```{r dc power flow jan ref 2 - ref 1, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_01 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_01 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_01 <- edge_average_flow_01 / edge_data[, 3]

scenario_name <- "ref_02"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_02 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_02 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_02 <- edge_average_flow_02 / edge_data[, 3]

node_average_balance <- node_average_balance_02 - node_average_balance_01
edge_average_flow <- edge_average_flow_02 - edge_average_flow_01
reference_power <- max(abs(range(node_average_balance)), reference_power_dc_diff_1)
reference_flow <- max(abs(range(edge_average_flow)), reference_edge_dc_diff_1)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  

  if(edge_average_flow[edge_iter] < 0){
    color_type = c("rgb(255, 200, 0)")
  }else{
    color_type = c("rgb(0, 0, 255)")
  }
  opaq <- abs(edge_average_flow[edge_iter] / reference_flow)^(1 / fractal_power)    
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor,
    type = 'scatter', mode = 'lines',
    line = list(color = color_type), opacity = opaq,
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Change in Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] - 25000 + 100000 + 50000 + 130000, 
  textfont = list(size = 18), text = "Change in Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(.25 * c(.5, 1, 2, 4) * reference_flow, 2)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 130000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(255, 200, 0)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 130000, 
    textfont = list(size = 14), text = paste(-edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 60000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(0, 0, 255)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 60000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

#### July
```{r dc power flow jul ref 2 - ref 1, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_01 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_01 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_01 <- edge_average_flow_01 / edge_data[, 3]

scenario_name <- "ref_02"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_02 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_02 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_02 <- edge_average_flow_02 / edge_data[, 3]

node_average_balance <- node_average_balance_02 - node_average_balance_01
edge_average_flow <- edge_average_flow_02 - edge_average_flow_01
reference_power <- max(abs(range(node_average_balance)), reference_power_dc_diff_1)
reference_flow <- max(abs(range(edge_average_flow)), reference_edge_dc_diff_1)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  

  if(edge_average_flow[edge_iter] < 0){
    color_type = c("rgb(255, 200, 0)")
  }else{
    color_type = c("rgb(0, 0, 255)")
  }
  opaq <- abs(edge_average_flow[edge_iter] / reference_flow)^(1 / fractal_power)    
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor,
    type = 'scatter', mode = 'lines',
    line = list(color = color_type), opacity = opaq,
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Change in Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] - 25000 + 100000 + 50000 + 130000, 
  textfont = list(size = 18), text = "Change in Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(.25 * c(.5, 1, 2, 4) * reference_flow, 2)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 130000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(255, 200, 0)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 130000, 
    textfont = list(size = 14), text = paste(-edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 60000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(0, 0, 255)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 60000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

### Difference Active - Ref 2 {.tabset .tabset-fade .tabset-pills}

#### January
```{r dc power flow jan active - ref 2, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_02"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_01 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_01 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_01 <- edge_average_flow_01 / edge_data[, 3]

scenario_name <- "active_end_user"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_02 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_02 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_02 <- edge_average_flow_02 / edge_data[, 3]

node_average_balance <- node_average_balance_02 - node_average_balance_01
edge_average_flow <- edge_average_flow_02 - edge_average_flow_01
reference_power <- max(abs(range(node_average_balance)), reference_power_dc_diff_2)
reference_flow <- max(abs(range(edge_average_flow)), reference_edge_dc_diff_2)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  

  if(edge_average_flow[edge_iter] < 0){
    color_type = c("rgb(255, 200, 0)")
  }else{
    color_type = c("rgb(0, 0, 255)")
  }
  opaq <- abs(edge_average_flow[edge_iter] / reference_flow)^(1 / fractal_power)    
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor,
    type = 'scatter', mode = 'lines',
    line = list(color = color_type), opacity = opaq,
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Change in Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50, 2) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] - 25000 + 100000 + 50000 + 130000, 
  textfont = list(size = 18), text = "Change in Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(.25 * c(.5, 1, 2, 4) * reference_flow, 3)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 130000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(255, 200, 0)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 130000, 
    textfont = list(size = 14), text = paste(-edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 60000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(0, 0, 255)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 60000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

#### July
```{r dc power flow jul active - ref 2, echo = FALSE, message = FALSE, warning = FALSE}
setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "TSO_simplified_network.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

scenario_name <- "ref_02"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_01 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_01 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_01 <- edge_average_flow_01 / edge_data[, 3]

scenario_name <- "active_end_user"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_market/", sep = "")

file_name <- "TSO_actual_supply.csv"
TSO_actual_supply <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_demand.csv"
TSO_actual_demand <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_DC_power.csv"
TSO_actual_DC_power <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_balance_02 <- apply(TSO_actual_supply - TSO_actual_demand, 2, mean)
edge_average_flow_02 <- apply(abs(TSO_actual_DC_power), 2, mean)
edge_average_flow_02 <- edge_average_flow_02 / edge_data[, 3]

node_average_balance <- node_average_balance_02 - node_average_balance_01
edge_average_flow <- edge_average_flow_02 - edge_average_flow_01
reference_power <- max(abs(range(node_average_balance)), reference_power_dc_diff_2)
reference_flow <- max(abs(range(edge_average_flow)), reference_edge_dc_diff_2)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot
for(edge_iter in 1:length(edge_average_flow)){
  x_coor <- c()
  y_coor <- c()
  
  x_coor[1] <- node_data$x[edge_data$from[edge_iter] + 1]
  x_coor[3] <- node_data$x[edge_data$to[edge_iter] + 1]
  x_coor[2] <- .5 * (x_coor[1] + x_coor[3])
  y_coor[1] <- node_data$y[edge_data$from[edge_iter] + 1]
  y_coor[3] <- node_data$y[edge_data$to[edge_iter] + 1]
  y_coor[2] <- .5 * (y_coor[1] + y_coor[3])  

  if(edge_average_flow[edge_iter] < 0){
    color_type = c("rgb(255, 200, 0)")
  }else{
    color_type = c("rgb(0, 0, 255)")
  }
  opaq <- abs(edge_average_flow[edge_iter] / reference_flow)^(1 / fractal_power)    
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = x_coor, y = y_coor,
    type = 'scatter', mode = 'lines',
    line = list(color = color_type), opacity = opaq,
    name = paste("edge ", edge_iter, sep = ""),
    text = paste("edge ", edge_iter, ": ", round(edge_average_flow[edge_iter], 3), sep = ""),
    hoverinfo = 'text'
    )
}

for(node_iter in 1:length(node_average_balance)){
  if(node_average_balance[node_iter] < 0){
    fraction <- -node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_balance[node_iter] / reference_power
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_balance[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Change in Average DC Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_power * c(1 / 8, 1 / 4, 1 / 2, 1) / 50, 2) * 50
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_power)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MW", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MW", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 120000, y = node_data$y[116] - 25000 + 100000 + 50000 + 130000, 
  textfont = list(size = 18), text = "Change in Average Line Utilization Rate:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(.25 * c(.5, 1, 2, 4) * reference_flow, 3)
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 130000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(255, 200, 0)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 130000, 
    textfont = list(size = 14), text = paste(-edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 60000, 2), 
    opacity = edge_level[level_iter]^(1 / fractal_power) / reference_flow, type = 'scatter', mode = 'lines', line = list(color = "rgb(0, 0, 255)"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 30000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 60000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter] * 100, "%"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp
```

<!-- title for toc -->
## - AC Power Flow {.tabset .tabset-fade .tabset-pills}

### Reference 1 {.tabset .tabset-fade .tabset-pills}

#### January
```{r ac power flow jan, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "transmission_edges.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")
I_base <- 1 / edge_data$voltage * 1000 # in Ampere

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "TSO_actual_AC_Q_node.csv"
TSO_actual_AC_Q_node <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_magnitude.csv"
TSO_actual_AC_current_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_angle.csv"
TSO_actual_AC_current_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

edge_current <- as.matrix(TSO_actual_AC_current_magnitude) * complex(real = cos(as.matrix(TSO_actual_AC_current_angle)), imaginary = sin(as.matrix(TSO_actual_AC_current_angle)))

file_name <- "TSO_actual_AC_voltage_magnitude.csv"
TSO_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_Q <- apply(TSO_actual_AC_Q_node, 2, mean)
edge_average_flow <- apply(edge_current, 2, mean) * I_base
reference_Q <- max(max(node_average_Q), -min(node_average_Q), reference_power_ac)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot

## Calculate redundant lines between nodes
Redundant <- matrix(0, nrow = nrow(node_data), ncol = nrow(node_data))
for(edge_iter in 1:nrow(edge_data)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]

  Redundant[from_ID, to_ID] <- Redundant[from_ID, to_ID] + edge_average_flow[edge_iter]
}
reference_I <- max(abs(Redundant))

for(edge_iter in 1:length(edge_average_flow)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]
  
  x_coor <- c(node_data$x[from_ID], 0, node_data$x[to_ID])
  y_coor <- c(node_data$y[from_ID], 0, node_data$y[to_ID])
  x_coor[2] <- x_coor[1] * .5 + x_coor[3] * .5
  y_coor[2] <- y_coor[1] * .5 + y_coor[3] * .5
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>% 
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = abs(Redundant[from_ID, to_ID] / reference_I)^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste(round(abs(Redundant[from_ID, to_ID]), 3), " A", sep = ""),
    hoverinfo = 'text'
    )    
}

for(node_iter in 1:length(node_average_Q)){
  if(node_average_Q[node_iter] < 0){
    fraction <- -node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_Q[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average Reactive Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_Q * c(1 / 8, 1 / 4, 1 / 2, 1) / 5) * 5
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Current:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(reference_I * c(1 / 8, 1  / 4, 1 / 2, 1) / 100) * 100
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = (edge_level[level_iter] / reference_I)^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter], "A"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp

```

#### July
```{r ac power flow jul, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "transmission_edges.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")
I_base <- 1 / edge_data$voltage * 1000 # in Ampere

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "TSO_actual_AC_Q_node.csv"
TSO_actual_AC_Q_node <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_magnitude.csv"
TSO_actual_AC_current_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_angle.csv"
TSO_actual_AC_current_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

edge_current <- as.matrix(TSO_actual_AC_current_magnitude) * complex(real = cos(as.matrix(TSO_actual_AC_current_angle)), imaginary = sin(as.matrix(TSO_actual_AC_current_angle)))

file_name <- "TSO_actual_AC_voltage_magnitude.csv"
TSO_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_Q <- apply(TSO_actual_AC_Q_node, 2, mean)
edge_average_flow <- apply(edge_current, 2, mean) * I_base
reference_Q <- max(max(node_average_Q), -min(node_average_Q), reference_power_ac)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot

## Calculate redundant lines between nodes
Redundant <- matrix(0, nrow = nrow(node_data), ncol = nrow(node_data))
for(edge_iter in 1:nrow(edge_data)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]

  Redundant[from_ID, to_ID] <- Redundant[from_ID, to_ID] + edge_average_flow[edge_iter]
}
reference_I <- max(abs(Redundant))

for(edge_iter in 1:length(edge_average_flow)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]
  
  x_coor <- c(node_data$x[from_ID], 0, node_data$x[to_ID])
  y_coor <- c(node_data$y[from_ID], 0, node_data$y[to_ID])
  x_coor[2] <- x_coor[1] * .5 + x_coor[3] * .5
  y_coor[2] <- y_coor[1] * .5 + y_coor[3] * .5
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>% 
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = abs(Redundant[from_ID, to_ID] / reference_I)^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste(round(abs(Redundant[from_ID, to_ID]), 3), " A", sep = ""),
    hoverinfo = 'text'
    )    
}

for(node_iter in 1:length(node_average_Q)){
  if(node_average_Q[node_iter] < 0){
    fraction <- -node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_Q[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average Reactive Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_Q * c(1 / 8, 1 / 4, 1 / 2, 1) / 5) * 5
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Current:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(reference_I * c(1 / 8, 1  / 4, 1 / 2, 1) / 100) * 100
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = (edge_level[level_iter] / reference_I)^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter], "A"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp

```

### Reference 2 {.tabset .tabset-fade .tabset-pills}

#### January
```{r ac power flow jan ref 2, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "transmission_edges.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")
I_base <- 1 / edge_data$voltage * 1000 # in Ampere

scenario_name <- "ref_02"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "TSO_actual_AC_Q_node.csv"
TSO_actual_AC_Q_node <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_magnitude.csv"
TSO_actual_AC_current_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_angle.csv"
TSO_actual_AC_current_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

edge_current <- as.matrix(TSO_actual_AC_current_magnitude) * complex(real = cos(as.matrix(TSO_actual_AC_current_angle)), imaginary = sin(as.matrix(TSO_actual_AC_current_angle)))

file_name <- "TSO_actual_AC_voltage_magnitude.csv"
TSO_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_Q <- apply(TSO_actual_AC_Q_node, 2, mean)
edge_average_flow <- apply(edge_current, 2, mean) * I_base
reference_Q <- max(max(node_average_Q), -min(node_average_Q), reference_power_ac)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot

## Calculate redundant lines between nodes
Redundant <- matrix(0, nrow = nrow(node_data), ncol = nrow(node_data))
for(edge_iter in 1:nrow(edge_data)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]

  Redundant[from_ID, to_ID] <- Redundant[from_ID, to_ID] + edge_average_flow[edge_iter]
}
reference_I <- max(abs(Redundant))

for(edge_iter in 1:length(edge_average_flow)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]
  
  x_coor <- c(node_data$x[from_ID], 0, node_data$x[to_ID])
  y_coor <- c(node_data$y[from_ID], 0, node_data$y[to_ID])
  x_coor[2] <- x_coor[1] * .5 + x_coor[3] * .5
  y_coor[2] <- y_coor[1] * .5 + y_coor[3] * .5
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>% 
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = abs(Redundant[from_ID, to_ID] / reference_I)^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste(round(abs(Redundant[from_ID, to_ID]), 3), " A", sep = ""),
    hoverinfo = 'text'
    )    
}

for(node_iter in 1:length(node_average_Q)){
  if(node_average_Q[node_iter] < 0){
    fraction <- -node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_Q[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average Reactive Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_Q * c(1 / 8, 1 / 4, 1 / 2, 1) / 5) * 5
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Current:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(reference_I * c(1 / 8, 1  / 4, 1 / 2, 1) / 100) * 100
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = (edge_level[level_iter] / reference_I)^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter], "A"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp

```

#### July
```{r ac power flow jul ref 2, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "transmission_edges.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")
I_base <- 1 / edge_data$voltage * 1000 # in Ampere

scenario_name <- "ref_02"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "TSO_actual_AC_Q_node.csv"
TSO_actual_AC_Q_node <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_magnitude.csv"
TSO_actual_AC_current_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_angle.csv"
TSO_actual_AC_current_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

edge_current <- as.matrix(TSO_actual_AC_current_magnitude) * complex(real = cos(as.matrix(TSO_actual_AC_current_angle)), imaginary = sin(as.matrix(TSO_actual_AC_current_angle)))

file_name <- "TSO_actual_AC_voltage_magnitude.csv"
TSO_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_Q <- apply(TSO_actual_AC_Q_node, 2, mean)
edge_average_flow <- apply(edge_current, 2, mean) * I_base
reference_Q <- max(max(node_average_Q), -min(node_average_Q), reference_power_ac)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot

## Calculate redundant lines between nodes
Redundant <- matrix(0, nrow = nrow(node_data), ncol = nrow(node_data))
for(edge_iter in 1:nrow(edge_data)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]

  Redundant[from_ID, to_ID] <- Redundant[from_ID, to_ID] + edge_average_flow[edge_iter]
}
reference_I <- max(abs(Redundant))

for(edge_iter in 1:length(edge_average_flow)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]
  
  x_coor <- c(node_data$x[from_ID], 0, node_data$x[to_ID])
  y_coor <- c(node_data$y[from_ID], 0, node_data$y[to_ID])
  x_coor[2] <- x_coor[1] * .5 + x_coor[3] * .5
  y_coor[2] <- y_coor[1] * .5 + y_coor[3] * .5
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>% 
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = abs(Redundant[from_ID, to_ID] / reference_I)^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste(round(abs(Redundant[from_ID, to_ID]), 3), " A", sep = ""),
    hoverinfo = 'text'
    )    
}

for(node_iter in 1:length(node_average_Q)){
  if(node_average_Q[node_iter] < 0){
    fraction <- -node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_Q[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average Reactive Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_Q * c(1 / 8, 1 / 4, 1 / 2, 1) / 5) * 5
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Current:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(reference_I * c(1 / 8, 1  / 4, 1 / 2, 1) / 100) * 100
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = (edge_level[level_iter] / reference_I)^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter], "A"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp

```

### Active End-users {.tabset .tabset-fade .tabset-pills}

#### January
```{r ac power flow jan active, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "transmission_edges.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")
I_base <- 1 / edge_data$voltage * 1000 # in Ampere

scenario_name <- "active_end_user"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "TSO_actual_AC_Q_node.csv"
TSO_actual_AC_Q_node <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_magnitude.csv"
TSO_actual_AC_current_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_angle.csv"
TSO_actual_AC_current_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

edge_current <- as.matrix(TSO_actual_AC_current_magnitude) * complex(real = cos(as.matrix(TSO_actual_AC_current_angle)), imaginary = sin(as.matrix(TSO_actual_AC_current_angle)))

file_name <- "TSO_actual_AC_voltage_magnitude.csv"
TSO_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_Q <- apply(TSO_actual_AC_Q_node, 2, mean)
edge_average_flow <- apply(edge_current, 2, mean) * I_base
reference_Q <- max(max(node_average_Q), -min(node_average_Q), reference_power_ac)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot

## Calculate redundant lines between nodes
Redundant <- matrix(0, nrow = nrow(node_data), ncol = nrow(node_data))
for(edge_iter in 1:nrow(edge_data)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]

  Redundant[from_ID, to_ID] <- Redundant[from_ID, to_ID] + edge_average_flow[edge_iter]
}
reference_I <- max(abs(Redundant))

for(edge_iter in 1:length(edge_average_flow)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]
  
  x_coor <- c(node_data$x[from_ID], 0, node_data$x[to_ID])
  y_coor <- c(node_data$y[from_ID], 0, node_data$y[to_ID])
  x_coor[2] <- x_coor[1] * .5 + x_coor[3] * .5
  y_coor[2] <- y_coor[1] * .5 + y_coor[3] * .5
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>% 
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = abs(Redundant[from_ID, to_ID] / reference_I)^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste(round(abs(Redundant[from_ID, to_ID]), 3), " A", sep = ""),
    hoverinfo = 'text'
    )    
}

for(node_iter in 1:length(node_average_Q)){
  if(node_average_Q[node_iter] < 0){
    fraction <- -node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_Q[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average Reactive Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_Q * c(1 / 8, 1 / 4, 1 / 2, 1) / 5) * 5
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Current:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(reference_I * c(1 / 8, 1  / 4, 1 / 2, 1) / 100) * 100
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = (edge_level[level_iter] / reference_I)^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter], "A"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp

```

#### July
```{r ac power flow jul active, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

dir_name <- paste(getwd(), "/data/input/", sep = "")
file_name <- "transmission_edges.csv"
edge_data <- read.csv(paste(dir_name, file_name, sep = ""), sep = ",")
I_base <- 1 / edge_data$voltage * 1000 # in Ampere

scenario_name <- "active_end_user"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "TSO_actual_AC_Q_node.csv"
TSO_actual_AC_Q_node <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_magnitude.csv"
TSO_actual_AC_current_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "TSO_actual_AC_current_angle.csv"
TSO_actual_AC_current_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

edge_current <- as.matrix(TSO_actual_AC_current_magnitude) * complex(real = cos(as.matrix(TSO_actual_AC_current_angle)), imaginary = sin(as.matrix(TSO_actual_AC_current_angle)))

file_name <- "TSO_actual_AC_voltage_magnitude.csv"
TSO_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

node_average_Q <- apply(TSO_actual_AC_Q_node, 2, mean)
edge_average_flow <- apply(edge_current, 2, mean) * I_base
reference_Q <- max(max(node_average_Q), -min(node_average_Q), reference_power_ac)

### Plot
NO_power_system_plot_temp <- NO_power_system_plot

## Calculate redundant lines between nodes
Redundant <- matrix(0, nrow = nrow(node_data), ncol = nrow(node_data))
for(edge_iter in 1:nrow(edge_data)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]

  Redundant[from_ID, to_ID] <- Redundant[from_ID, to_ID] + edge_average_flow[edge_iter]
}
reference_I <- max(abs(Redundant))

for(edge_iter in 1:length(edge_average_flow)){
  from_ID <- edge_data$from[edge_iter]
  to_ID <- edge_data$to[edge_iter]
  
  x_coor <- c(node_data$x[from_ID], 0, node_data$x[to_ID])
  y_coor <- c(node_data$y[from_ID], 0, node_data$y[to_ID])
  x_coor[2] <- x_coor[1] * .5 + x_coor[3] * .5
  y_coor[2] <- y_coor[1] * .5 + y_coor[3] * .5
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>% 
    add_trace(x = x_coor, y = y_coor, 
    type = 'scatter', mode = 'lines',
    line = list(color = "black"), opacity = abs(Redundant[from_ID, to_ID] / reference_I)^(1 / fractal_power),
    name = paste("edge ", edge_iter, sep = ""),
    text = paste(round(abs(Redundant[from_ID, to_ID]), 3), " A", sep = ""),
    hoverinfo = 'text'
    )    
}

for(node_iter in 1:length(node_average_Q)){
  if(node_average_Q[node_iter] < 0){
    fraction <- -node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(", 255, ", 0, 0)")
  }else{
    fraction <- node_average_Q[node_iter] / reference_Q
    color_type = paste("rgb(0,", 200, ", 0)", sep = "")
  }
  opaq <- fraction^(1 / fractal_power)
  
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[node_iter], y = node_data$y[node_iter], opacity = opaq,
    type = 'scatter', mode = 'markers',
    marker = list(color = color_type, size = 20),
    name = paste("node ", node_iter, sep = ""),
    text = paste("node ", node_iter, ": ", round(node_average_Q[node_iter], 3), " MW", sep = ""),
    hoverinfo = 'text'    
    )
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] + 40000, 
  textfont = list(size = 18), text = "Average Reactive Power Source / Sink:", textposition = "top right", hoverinfo = 'none')
legend_level <- round(reference_Q * c(1 / 8, 1 / 4, 1 / 2, 1) / 5) * 5
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116], 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(", 255, ", 0, 0)"), size = 30),
    name = paste(-legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000, 
    text = paste (-legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(255, 0, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}
for(level_iter in 1:length(legend_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 100000, 
    opacity = (legend_level[level_iter] / reference_Q)^(1 / fractal_power),
    type = 'scatter', mode = 'markers',
    marker = list(color = paste("rgb(0, ", 200, ", 0)"), size = 30),
    name = paste (legend_level[level_iter], " MVA", sep = ""),
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 30000 - 100000, 
    text = paste (legend_level[level_iter], " MVA", sep = ""), 
    textfont = list(color = "rgb(0, 200, 0)", size = 14),
    textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
  add_text(x = node_data$x[132] + 170000, y = node_data$y[116] - 25000 + 100000 + 50000 + 100000, 
  textfont = list(size = 18), text = "Average Line Current:", textposition = "top right", hoverinfo = 'none')
edge_level <- round(reference_I * c(1 / 8, 1  / 4, 1 / 2, 1) / 100) * 100
for(level_iter in 1:length(edge_level)){
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_trace(x = node_data$x[132] + 50000 + 120000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000 + 100000, 2), 
    opacity = (edge_level[level_iter] / reference_I)^(1 / fractal_power), type = 'scatter', mode = 'lines', line = list(color = "black"), 
    hoverinfo = 'none'
    )
  NO_power_system_plot_temp <- NO_power_system_plot_temp %>%
    add_text(x = node_data$x[132] + 80000 + 120000 * level_iter, y = node_data$y[116] - 25000 + 100000 + 100000, 
    textfont = list(size = 14), text = paste(edge_level[level_iter], "A"), textposition = "bottom center", hoverinfo = 'none')
}

NO_power_system_plot_temp

```

<!-- title for toc -->
## - Voltage Magnitude Field {.tabset .tabset-fade .tabset-pills}

### Reference 1 {.tabset .tabset-fade .tabset-pills}

#### January
```{r voltage jan, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "whole_actual_AC_voltage_angle.csv"
whole_actual_AC_voltage_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "whole_actual_AC_voltage_magnitude.csv"
whole_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

voltage_field <- as.matrix(whole_actual_AC_voltage_magnitude) * complex(real = cos(as.matrix(whole_actual_AC_voltage_angle)), imaginary = sin(as.matrix(whole_actual_AC_voltage_angle)))

average_voltage_field <- apply(voltage_field, 2, mean)
# average_voltage_field <- abs(voltage_field[160,])
# average_voltage_field <- apply(abs(voltage_field), 2, max)
average_voltage_field <- average_voltage_field[(nrow(node_data) + 1):length(average_voltage_field)]

voltage_Mat <- as.matrix(point_matrix)
for(row_iter in 1:nrow(voltage_Mat)){
  for(col_iter in 1:ncol(voltage_Mat)){
    if(point_matrix[row_iter, col_iter] == -1){
      voltage_Mat[row_iter, col_iter] <- NA
    }else{
      voltage_Mat[row_iter, col_iter] <- abs(average_voltage_field[point_matrix[row_iter, col_iter]])
    }
  }
}
voltage_Mat <- t(voltage_Mat)

### Parameters for the field
v_min <- min(min(range(voltage_Mat,na.rm = T)), reference_voltage[1])
v_max <- max(max(range(voltage_Mat,na.rm = T)), reference_voltage[2])
v_extend <- seq(v_min, v_max, length.out = 10000)
cols_extend <- scales::col_numeric("YlOrRd", domain = NULL)(v_extend)
start_ID <- round((min(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
end_ID <- round((max(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
v_vals <- v_extend[start_ID:end_ID]
v_vals_norm <- unique(scales::rescale(c(v_vals)))
cols <- cols_extend[start_ID:end_ID]
colz <- setNames(data.frame(v_vals_norm, cols), NULL)

NO_field_plot <- NO_power_system_plot %>%
  add_trace(x = seq(x_range_field [1], x_range_field [2], res_field),
  y = seq(y_range_field [1], y_range_field [2], res_field),
  z = voltage_Mat, type = "heatmap",
  hoverinfo = 'none',
  showscale = F,
  colorscale = colz)

NO_field_plot <- NO_field_plot %>%
  add_trace(x = point_data$x, y = point_data$y,
  type = 'scatter', mode = 'markers',
  marker = list(color = "black", size = 0),
  opacity = 0,
  text = paste("\nlon: ", round(point_data$lon, 3), "",
               "\nlat: ", round(point_data$lat, 3), "",
               "\n\nVoltage Magnitude:\n", round(abs(average_voltage_field), 3),
               " p.u.", 
               sep = ""),
  hoverinfo = 'text'
  )

NO_field_plot <- NO_field_plot %>%
  add_text(x = node_data$x[132] + 150000, y = node_data$y[116] - 25000 + 100000 + 50000, 
  textfont = list(size = 18), text = "Voltage Magnitude (p.u.):", textposition = "top right", hoverinfo = 'none')
palette_level <- cols_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))]
voltage_level <- round(v_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))], 3)
for(level_iter in 1:length(voltage_level)){
  NO_field_plot <- NO_field_plot %>%
    add_trace(x = node_data$x[132] + 50000 + 100000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000, 2),
    type = 'scatter', mode = 'lines', line = list(color = palette_level[level_iter], width = 10),
    hoverinfo = 'none'
    )
  NO_field_plot <- NO_field_plot %>%
    add_text(x = node_data$x[132] + 80000 + 100000 * level_iter, y = node_data$y[116] - 25000 + 100000,
    textfont = list(size = 14), text = voltage_level[level_iter], textposition = "bottom center", hoverinfo = 'none')
}

NO_field_plot
```

#### July
```{r voltage jul, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

scenario_name <- "ref_01"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "whole_actual_AC_voltage_angle.csv"
whole_actual_AC_voltage_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "whole_actual_AC_voltage_magnitude.csv"
whole_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

voltage_field <- as.matrix(whole_actual_AC_voltage_magnitude) * complex(real = cos(as.matrix(whole_actual_AC_voltage_angle)), imaginary = sin(as.matrix(whole_actual_AC_voltage_angle)))

average_voltage_field <- apply(voltage_field, 2, mean)
average_voltage_field <- average_voltage_field[(nrow(node_data) + 1):length(average_voltage_field)]

voltage_Mat <- as.matrix(point_matrix)
for(row_iter in 1:nrow(voltage_Mat)){
  for(col_iter in 1:ncol(voltage_Mat)){
    if(point_matrix[row_iter, col_iter] == -1){
      voltage_Mat[row_iter, col_iter] <- NA
    }else{
      voltage_Mat[row_iter, col_iter] <- abs(average_voltage_field[point_matrix[row_iter, col_iter]])
    }
  }
}
voltage_Mat <- t(voltage_Mat)

### Parameters for the field
v_min <- min(min(range(voltage_Mat,na.rm = T)), reference_voltage[1])
v_max <- max(max(range(voltage_Mat,na.rm = T)), reference_voltage[2])
v_extend <- seq(v_min, v_max, length.out = 10000)
cols_extend <- scales::col_numeric("YlOrRd", domain = NULL)(v_extend)
start_ID <- round((min(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
end_ID <- round((max(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
v_vals <- v_extend[start_ID:end_ID]
v_vals_norm <- unique(scales::rescale(c(v_vals)))
cols <- cols_extend[start_ID:end_ID]
colz <- setNames(data.frame(v_vals_norm, cols), NULL)

NO_field_plot <- NO_power_system_plot %>%
  add_trace(x = seq(x_range_field [1], x_range_field [2], res_field),
  y = seq(y_range_field [1], y_range_field [2], res_field),
  z = voltage_Mat, type = "heatmap",
  hoverinfo = 'none',
  showscale = F,
  colorscale = colz)

NO_field_plot <- NO_field_plot %>%
  add_trace(x = point_data$x, y = point_data$y,
  type = 'scatter', mode = 'markers',
  marker = list(color = "black", size = 0),
  opacity = 0,
  text = paste("\nlon: ", round(point_data$lon, 3), "",
               "\nlat: ", round(point_data$lat, 3), "",
               "\n\nVoltage Magnitude:\n", round(abs(average_voltage_field), 3),
               " p.u.", 
               sep = ""),
  hoverinfo = 'text'
  )

NO_field_plot <- NO_field_plot %>%
  add_text(x = node_data$x[132] + 150000, y = node_data$y[116] - 25000 + 100000 + 50000, 
  textfont = list(size = 18), text = "Voltage Magnitude (p.u.):", textposition = "top right", hoverinfo = 'none')
palette_level <- cols_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))]
voltage_level <- round(v_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))], 3)
for(level_iter in 1:length(voltage_level)){
  NO_field_plot <- NO_field_plot %>%
    add_trace(x = node_data$x[132] + 50000 + 100000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000, 2),
    type = 'scatter', mode = 'lines', line = list(color = palette_level[level_iter], width = 10),
    hoverinfo = 'none'
    )
  NO_field_plot <- NO_field_plot %>%
    add_text(x = node_data$x[132] + 80000 + 100000 * level_iter, y = node_data$y[116] - 25000 + 100000,
    textfont = list(size = 14), text = voltage_level[level_iter], textposition = "bottom center", hoverinfo = 'none')
}

NO_field_plot
```

### Reference 2 {.tabset .tabset-fade .tabset-pills}

#### January
```{r voltage jan ref 2, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

scenario_name <- "ref_02"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "whole_actual_AC_voltage_angle.csv"
whole_actual_AC_voltage_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "whole_actual_AC_voltage_magnitude.csv"
whole_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

voltage_field <- as.matrix(whole_actual_AC_voltage_magnitude) * complex(real = cos(as.matrix(whole_actual_AC_voltage_angle)), imaginary = sin(as.matrix(whole_actual_AC_voltage_angle)))

average_voltage_field <- apply(voltage_field, 2, mean)
average_voltage_field <- average_voltage_field[(nrow(node_data) + 1):length(average_voltage_field)]

voltage_Mat <- as.matrix(point_matrix)
for(row_iter in 1:nrow(voltage_Mat)){
  for(col_iter in 1:ncol(voltage_Mat)){
    if(point_matrix[row_iter, col_iter] == -1){
      voltage_Mat[row_iter, col_iter] <- NA
    }else{
      voltage_Mat[row_iter, col_iter] <- abs(average_voltage_field[point_matrix[row_iter, col_iter]])
    }
  }
}
voltage_Mat <- t(voltage_Mat)

### Parameters for the field
v_min <- min(min(range(voltage_Mat,na.rm = T)), reference_voltage[1])
v_max <- max(max(range(voltage_Mat,na.rm = T)), reference_voltage[2])
v_extend <- seq(v_min, v_max, length.out = 10000)
cols_extend <- scales::col_numeric("YlOrRd", domain = NULL)(v_extend)
start_ID <- round((min(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
end_ID <- round((max(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
v_vals <- v_extend[start_ID:end_ID]
v_vals_norm <- unique(scales::rescale(c(v_vals)))
cols <- cols_extend[start_ID:end_ID]
colz <- setNames(data.frame(v_vals_norm, cols), NULL)

NO_field_plot <- NO_power_system_plot %>%
  add_trace(x = seq(x_range_field [1], x_range_field [2], res_field),
  y = seq(y_range_field [1], y_range_field [2], res_field),
  z = voltage_Mat, type = "heatmap",
  hoverinfo = 'none',
  showscale = F,
  colorscale = colz)

NO_field_plot <- NO_field_plot %>%
  add_trace(x = point_data$x, y = point_data$y,
  type = 'scatter', mode = 'markers',
  marker = list(color = "black", size = 0),
  opacity = 0,
  text = paste("\nlon: ", round(point_data$lon, 3), "",
               "\nlat: ", round(point_data$lat, 3), "",
               "\n\nVoltage Magnitude:\n", round(abs(average_voltage_field), 3),
               " p.u.", 
               sep = ""),
  hoverinfo = 'text'
  )

NO_field_plot <- NO_field_plot %>%
  add_text(x = node_data$x[132] + 150000, y = node_data$y[116] - 25000 + 100000 + 50000, 
  textfont = list(size = 18), text = "Voltage Magnitude (p.u.):", textposition = "top right", hoverinfo = 'none')
palette_level <- cols_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))]
voltage_level <- round(v_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))], 3)
for(level_iter in 1:length(voltage_level)){
  NO_field_plot <- NO_field_plot %>%
    add_trace(x = node_data$x[132] + 50000 + 100000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000, 2),
    type = 'scatter', mode = 'lines', line = list(color = palette_level[level_iter], width = 10),
    hoverinfo = 'none'
    )
  NO_field_plot <- NO_field_plot %>%
    add_text(x = node_data$x[132] + 80000 + 100000 * level_iter, y = node_data$y[116] - 25000 + 100000,
    textfont = list(size = 14), text = voltage_level[level_iter], textposition = "bottom center", hoverinfo = 'none')
}

NO_field_plot
```

#### July
```{r voltage jul ref 2, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

scenario_name <- "ref_02"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "whole_actual_AC_voltage_angle.csv"
whole_actual_AC_voltage_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "whole_actual_AC_voltage_magnitude.csv"
whole_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

voltage_field <- as.matrix(whole_actual_AC_voltage_magnitude) * complex(real = cos(as.matrix(whole_actual_AC_voltage_angle)), imaginary = sin(as.matrix(whole_actual_AC_voltage_angle)))

average_voltage_field <- apply(voltage_field, 2, mean)
average_voltage_field <- average_voltage_field[(nrow(node_data) + 1):length(average_voltage_field)]

voltage_Mat <- as.matrix(point_matrix)
for(row_iter in 1:nrow(voltage_Mat)){
  for(col_iter in 1:ncol(voltage_Mat)){
    if(point_matrix[row_iter, col_iter] == -1){
      voltage_Mat[row_iter, col_iter] <- NA
    }else{
      voltage_Mat[row_iter, col_iter] <- abs(average_voltage_field[point_matrix[row_iter, col_iter]])
    }
  }
}
voltage_Mat <- t(voltage_Mat)

### Parameters for the field
v_min <- min(min(range(voltage_Mat,na.rm = T)), reference_voltage[1])
v_max <- max(max(range(voltage_Mat,na.rm = T)), reference_voltage[2])
v_extend <- seq(v_min, v_max, length.out = 10000)
cols_extend <- scales::col_numeric("YlOrRd", domain = NULL)(v_extend)
start_ID <- round((min(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
end_ID <- round((max(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
v_vals <- v_extend[start_ID:end_ID]
v_vals_norm <- unique(scales::rescale(c(v_vals)))
cols <- cols_extend[start_ID:end_ID]
colz <- setNames(data.frame(v_vals_norm, cols), NULL)

NO_field_plot <- NO_power_system_plot %>%
  add_trace(x = seq(x_range_field [1], x_range_field [2], res_field),
  y = seq(y_range_field [1], y_range_field [2], res_field),
  z = voltage_Mat, type = "heatmap",
  hoverinfo = 'none',
  showscale = F,
  colorscale = colz)

NO_field_plot <- NO_field_plot %>%
  add_trace(x = point_data$x, y = point_data$y,
  type = 'scatter', mode = 'markers',
  marker = list(color = "black", size = 0),
  opacity = 0,
  text = paste("\nlon: ", round(point_data$lon, 3), "",
               "\nlat: ", round(point_data$lat, 3), "",
               "\n\nVoltage Magnitude:\n", round(abs(average_voltage_field), 3),
               " p.u.", 
               sep = ""),
  hoverinfo = 'text'
  )

NO_field_plot <- NO_field_plot %>%
  add_text(x = node_data$x[132] + 150000, y = node_data$y[116] - 25000 + 100000 + 50000, 
  textfont = list(size = 18), text = "Voltage Magnitude (p.u.):", textposition = "top right", hoverinfo = 'none')
palette_level <- cols_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))]
voltage_level <- round(v_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))], 3)
for(level_iter in 1:length(voltage_level)){
  NO_field_plot <- NO_field_plot %>%
    add_trace(x = node_data$x[132] + 50000 + 100000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000, 2),
    type = 'scatter', mode = 'lines', line = list(color = palette_level[level_iter], width = 10),
    hoverinfo = 'none'
    )
  NO_field_plot <- NO_field_plot %>%
    add_text(x = node_data$x[132] + 80000 + 100000 * level_iter, y = node_data$y[116] - 25000 + 100000,
    textfont = list(size = 14), text = voltage_level[level_iter], textposition = "bottom center", hoverinfo = 'none')
}

NO_field_plot
```

### Active End-users {.tabset .tabset-fade .tabset-pills}

#### January
```{r voltage jan active, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

scenario_name <- "active_end_user"
time_name <- "0101-0114"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "whole_actual_AC_voltage_angle.csv"
whole_actual_AC_voltage_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "whole_actual_AC_voltage_magnitude.csv"
whole_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

voltage_field <- as.matrix(whole_actual_AC_voltage_magnitude) * complex(real = cos(as.matrix(whole_actual_AC_voltage_angle)), imaginary = sin(as.matrix(whole_actual_AC_voltage_angle)))

average_voltage_field <- apply(voltage_field, 2, mean)
average_voltage_field <- average_voltage_field[(nrow(node_data) + 1):length(average_voltage_field)]

voltage_Mat <- as.matrix(point_matrix)
for(row_iter in 1:nrow(voltage_Mat)){
  for(col_iter in 1:ncol(voltage_Mat)){
    if(point_matrix[row_iter, col_iter] == -1){
      voltage_Mat[row_iter, col_iter] <- NA
    }else{
      voltage_Mat[row_iter, col_iter] <- abs(average_voltage_field[point_matrix[row_iter, col_iter]])
    }
  }
}
voltage_Mat <- t(voltage_Mat)

### Parameters for the field
v_min <- min(min(range(voltage_Mat,na.rm = T)), reference_voltage[1])
v_max <- max(max(range(voltage_Mat,na.rm = T)), reference_voltage[2])
v_extend <- seq(v_min, v_max, length.out = 10000)
cols_extend <- scales::col_numeric("YlOrRd", domain = NULL)(v_extend)
start_ID <- round((min(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
end_ID <- round((max(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
v_vals <- v_extend[start_ID:end_ID]
v_vals_norm <- unique(scales::rescale(c(v_vals)))
cols <- cols_extend[start_ID:end_ID]
colz <- setNames(data.frame(v_vals_norm, cols), NULL)

NO_field_plot <- NO_power_system_plot %>%
  add_trace(x = seq(x_range_field [1], x_range_field [2], res_field),
  y = seq(y_range_field [1], y_range_field [2], res_field),
  z = voltage_Mat, type = "heatmap",
  hoverinfo = 'none',
  showscale = F,
  colorscale = colz)

NO_field_plot <- NO_field_plot %>%
  add_trace(x = point_data$x, y = point_data$y,
  type = 'scatter', mode = 'markers',
  marker = list(color = "black", size = 0),
  opacity = 0,
  text = paste("\nlon: ", round(point_data$lon, 3), "",
               "\nlat: ", round(point_data$lat, 3), "",
               "\n\nVoltage Magnitude:\n", round(abs(average_voltage_field), 3),
               " p.u.", 
               sep = ""),
  hoverinfo = 'text'
  )

NO_field_plot <- NO_field_plot %>%
  add_text(x = node_data$x[132] + 150000, y = node_data$y[116] - 25000 + 100000 + 50000, 
  textfont = list(size = 18), text = "Voltage Magnitude (p.u.):", textposition = "top right", hoverinfo = 'none')
palette_level <- cols_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))]
voltage_level <- round(v_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))], 3)
for(level_iter in 1:length(voltage_level)){
  NO_field_plot <- NO_field_plot %>%
    add_trace(x = node_data$x[132] + 50000 + 100000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000, 2),
    type = 'scatter', mode = 'lines', line = list(color = palette_level[level_iter], width = 10),
    hoverinfo = 'none'
    )
  NO_field_plot <- NO_field_plot %>%
    add_text(x = node_data$x[132] + 80000 + 100000 * level_iter, y = node_data$y[116] - 25000 + 100000,
    textfont = list(size = 14), text = voltage_level[level_iter], textposition = "bottom center", hoverinfo = 'none')
}

NO_field_plot
```

#### July
```{r voltage jul active, echo = FALSE, message = FALSE, warning = FALSE}

setwd(parent_dir)

scenario_name <- "active_end_user"
time_name <- "0701-0714"
dir_name <- paste(getwd(), "/data/output/", scenario_name, "/", time_name, "/power_network/", sep = "")

file_name <- "whole_actual_AC_voltage_angle.csv"
whole_actual_AC_voltage_angle <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

file_name <- "whole_actual_AC_voltage_magnitude.csv"
whole_actual_AC_voltage_magnitude <- read.csv(paste(dir_name, file_name, sep = ""), sep = "")

voltage_field <- as.matrix(whole_actual_AC_voltage_magnitude) * complex(real = cos(as.matrix(whole_actual_AC_voltage_angle)), imaginary = sin(as.matrix(whole_actual_AC_voltage_angle)))

average_voltage_field <- apply(voltage_field, 2, mean)
average_voltage_field <- average_voltage_field[(nrow(node_data) + 1):length(average_voltage_field)]

voltage_Mat <- as.matrix(point_matrix)
for(row_iter in 1:nrow(voltage_Mat)){
  for(col_iter in 1:ncol(voltage_Mat)){
    if(point_matrix[row_iter, col_iter] == -1){
      voltage_Mat[row_iter, col_iter] <- NA
    }else{
      voltage_Mat[row_iter, col_iter] <- abs(average_voltage_field[point_matrix[row_iter, col_iter]])
    }
  }
}
voltage_Mat <- t(voltage_Mat)

### Parameters for the field
v_min <- min(min(range(voltage_Mat,na.rm = T)), reference_voltage[1])
v_max <- max(max(range(voltage_Mat,na.rm = T)), reference_voltage[2])
v_extend <- seq(v_min, v_max, length.out = 10000)
cols_extend <- scales::col_numeric("YlOrRd", domain = NULL)(v_extend)
start_ID <- round((min(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
end_ID <- round((max(range(voltage_Mat,na.rm = T)) - v_min) / (v_max - v_min) * length(v_extend))
v_vals <- v_extend[start_ID:end_ID]
v_vals_norm <- unique(scales::rescale(c(v_vals)))
cols <- cols_extend[start_ID:end_ID]
colz <- setNames(data.frame(v_vals_norm, cols), NULL)

NO_field_plot <- NO_power_system_plot %>%
  add_trace(x = seq(x_range_field [1], x_range_field [2], res_field),
  y = seq(y_range_field [1], y_range_field [2], res_field),
  z = voltage_Mat, type = "heatmap",
  hoverinfo = 'none',
  showscale = F,
  colorscale = colz)

NO_field_plot <- NO_field_plot %>%
  add_trace(x = point_data$x, y = point_data$y,
  type = 'scatter', mode = 'markers',
  marker = list(color = "black", size = 0),
  opacity = 0,
  text = paste("\nlon: ", round(point_data$lon, 3), "",
               "\nlat: ", round(point_data$lat, 3), "",
               "\n\nVoltage Magnitude:\n", round(abs(average_voltage_field), 3),
               " p.u.", 
               sep = ""),
  hoverinfo = 'text'
  )

NO_field_plot <- NO_field_plot %>%
  add_text(x = node_data$x[132] + 150000, y = node_data$y[116] - 25000 + 100000 + 50000, 
  textfont = list(size = 18), text = "Voltage Magnitude (p.u.):", textposition = "top right", hoverinfo = 'none')
palette_level <- cols_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))]
voltage_level <- round(v_extend[c(1, seq(.25, .75, .25) * length(v_extend), length(v_extend))], 3)
for(level_iter in 1:length(voltage_level)){
  NO_field_plot <- NO_field_plot %>%
    add_trace(x = node_data$x[132] + 50000 + 100000 * level_iter + 60000 * c(0: 1), y = rep(node_data$y[116] + 100000, 2),
    type = 'scatter', mode = 'lines', line = list(color = palette_level[level_iter], width = 10),
    hoverinfo = 'none'
    )
  NO_field_plot <- NO_field_plot %>%
    add_text(x = node_data$x[132] + 80000 + 100000 * level_iter, y = node_data$y[116] - 25000 + 100000,
    textfont = list(size = 14), text = voltage_level[level_iter], textposition = "bottom center", hoverinfo = 'none')
}

NO_field_plot
```